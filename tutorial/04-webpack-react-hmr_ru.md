# 04 - Webpack, React –∏ Hot Module Replacement

–ö–æ–¥ –¥–ª—è —ç—Ç–æ–π –≥–ª–∞–≤—ã –¥–æ—Å—Ç—É–ø–µ–Ω [–∑–¥–µ—Å—å](https://github.com/verekia/js-stack-walkthrough/tree/master/04-webpack-react-hmr).

## Webpack

> üí° **[Webpack](https://webpack.js.org/)** - *—Å–±–æ—Ä—â–∏–∫ –º–æ–¥—É–ª–µ–π*. –û–Ω –±–µ—Ä–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤ –æ–¥–∏–Ω (–æ–±—ã—á–Ω–æ) JavaScript —Ñ–∞–π–ª, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π —Å–±–æ—Ä–∫–æ–π, –∏ —ç—Ç–æ –±—É–¥–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –ø—Ä–æ—Å—Ç–æ–π *hello world* –∏ —Å–æ–±–µ—Ä–µ–º –µ–≥–æ —Å –ø–æ–º–æ—â—å—é Webpack.

- –í `src/shared/config.js` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

```js
export const WDS_PORT = 7000

export const APP_CONTAINER_CLASS = 'js-app'
export const APP_CONTAINER_SELECTOR = `.${APP_CONTAINER_CLASS}`
```

- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `src/client/index.js`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:

```js
import 'babel-polyfill'

import { APP_CONTAINER_SELECTOR } from '../shared/config'

document.querySelector(APP_CONTAINER_SELECTOR).innerHTML = '<h1>Hello Webpack!</h1>'
```

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤–µ–π—à–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ES –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ `Promise`, —Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å [Babel Polyfill](https://babeljs.io/docs/usage/polyfill/) –¥–æ –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ –¥—Ä—É–≥–æ–≥–æ –∫–æ–¥–∞ –≤ —Å–±–æ—Ä–∫–µ.

- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn add babel-polyfill`

–ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ ESLint –Ω–∞ —ç—Ç–æ–º —Ñ–∞–π–ª–µ, –æ–Ω –±—É–¥–µ—Ç –∂–∞–ª–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ `document` undefined.

- –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª `env` –≤ `.eslintrc.json`, —á—Ç–æ–±—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `window` –∏ `document`:

```json
"env": {
  "browser": true,
  "jest": true
}
```

–•–æ—Ä–æ—à–æ, —Ç–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ ES6 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ ES5 —Å–±–æ—Ä–∫—É.

- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `webpack.config.babel.js` —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:

```js
// @flow

import path from 'path'

import { WDS_PORT } from './src/shared/config'
import { isProd } from './src/shared/util'

export default {
  entry: [
    './src/client',
  ],
  output: {
    filename: 'js/bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: isProd ? '/static/' : `http://localhost:${WDS_PORT}/dist/`,
  },
  module: {
    rules: [
      { test: /\.(js|jsx)$/, use: 'babel-loader', exclude: /node_modules/ },
    ],
  },
  devtool: isProd ? false : 'source-map',
  resolve: {
    extensions: ['.js', '.jsx'],
  },
  devServer: {
    port: WDS_PORT,
  },
}
```

–≠—Ç–æ—Ç —Ñ–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞—à–∞ —Å–±–æ—Ä–∫–∞: `entry` - —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, `output.filename` - –∏–º—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å–±–æ—Ä–∫–∏, `output.path` –∏ `output.publicPath` –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ —Å–æ —Å–±–æ—Ä–∫–æ–π –∏ URL. –ú—ã –ø–æ–º–µ—Å—Ç–∏–º —Å–±–æ—Ä–∫—É –≤ –ø–∞–ø–∫—É  `dist`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –≤–µ—â–∏ (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±–∏—Ç–∞—é—â–∏—Ö –≤ `public` –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö CSS, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ –¥–æ —ç—Ç–æ–≥–æ). –í `module.rules` –º—ã —Å–æ–æ–±—â–∞–µ–º Webpack –∫ –∫–∞–∫–∏–º —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫–∞–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏. –ó–¥–µ—Å—å –º—ã –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ —Ö–æ—Ç–∏–º –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤—Å–µ `.js` –∏ `.jsx` (–¥–ª—è —Ä–µ–∞–∫—Ç–∞) —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ –Ω–µ—á—Ç–æ, –Ω–∞–∑—ã–≤–∞–µ–º–æ–µ `babel-loader`, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–æ–≥–æ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `node_modules`. –ú—ã —Ç–∞–∫–∂–µ —Ö–æ—Ç–∏–º *—Ä–∞–∑—Ä–µ—à–∞—Ç—å* (`resolve`) —ç—Ç–∏ –¥–≤–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø—Ä–∏ `import` –º–æ–¥—É–ª–µ–π (—Ç.–µ. —ç—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ - –ø—Ä–∏–º. –ø–µ—Ä.)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.babel.js` —Å–æ–æ–±—â–∞–µ—Ç Webpack –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ Babel –∫ –¥–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É. 

`babel-loader` - —ç—Ç–æ –ø–ª–∞–≥–∏–Ω –¥–ª—è Webpack, —Ç—Ä–∞–Ω—Å–ø–∏–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥, —Ç–∞–∫ –∂–µ –∫–∞–∫ –º—ã —ç—Ç–æ –¥–µ–ª–∞–ª–∏ —Å –Ω–∞—á–∞–ª–∞ —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ—Ç–ª–∏—á–∏–µ, —á—Ç–æ —ç—Ç–æ—Ç –∫–æ–¥ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∞ –Ω–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn add --dev webpack webpack-dev-server babel-core babel-loader`

`babel-core` is a peer-dependency of `babel-loader`, so we installed it as well.
–ú—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Ç–∞–∫–∂–µ `babel-core`, –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ peer-dependency (—Ç—Ä–µ–±—É–µ–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å) –¥–ª—è `babel-loader`.

- –î–æ–±–∞–≤—å—Ç–µ `/dist/` –≤ `.gitignore`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `webpack-dev-server` —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ Hot Module Reloading (–ø–æ–∑–∂–µ –≤ —ç—Ç–æ–π –≥–ª–∞–≤–µ), –∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –º—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º `webpack`, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É. –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö, —Ñ–ª–∞–≥ `--progress` –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –≤—ã–≤–æ–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ Webpack –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –º—ã —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤ `webpack` —Ñ–ª–∞–≥ `-p` –¥–ª—è –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `NODE_ENV` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤ `production`.

–î–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –Ω–∞—à–∏ `scripts` —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ, –∞ —Ç–∞–∫–∂–µ —É–ª—É—á—à–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏:

```json
"scripts": {
  "start": "yarn dev:start",
  "dev:start": "nodemon -e js,jsx --ignore lib --ignore dist --exec babel-node src/server",
  "dev:wds": "webpack-dev-server --progress",
  "prod:build": "rimraf lib dist && babel src -d lib --ignore .test.js && cross-env NODE_ENV=production webpack -p --progress",
  "prod:start": "cross-env NODE_ENV=production pm2 start lib/server && pm2 logs",
  "prod:stop": "pm2 delete server",
  "lint": "eslint src webpack.config.babel.js --ext .js,.jsx",
  "test": "yarn lint && flow && jest --coverage",
  "precommit": "yarn test",
  "prepush": "yarn test && yarn prod:build"
},
```

–í `dev:start` –º—ã —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è: `.js` –∏ `.jsx`, –∏ –¥–æ–±–∞–≤–ª—è–µ–º `dist` –≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –∑–∞–¥–∞—á—É `lint` –∏ –¥–æ–±–∞–≤–∏–ª–∏ `webpack.config.babel.js` –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤.

- –ó–∞—Ç–µ–º –¥–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ `src/server/render-app.js` –∏ –≤–∫–ª—é—á–∏–º –µ–≥–æ –≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—É—é —Å–±–æ—Ä–∫—É:

```js
// @flow

import { APP_CONTAINER_CLASS, STATIC_PATH, WDS_PORT } from '../shared/config'
import { isProd } from '../shared/util'

const renderApp = (title: string) =>
`<!doctype html>
<html>
  <head>
    <title>${title}</title>
    <link rel="stylesheet" href="${STATIC_PATH}/css/style.css">
  </head>
  <body>
    <div class="${APP_CONTAINER_CLASS}"></div>
    <script src="${isProd ? STATIC_PATH : `http://localhost:${WDS_PORT}/dist`}/js/bundle.js"></script>
  </body>
</html>
`

export default renderApp
```

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–æ–µ —É –Ω–∞—Å –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –º—ã –≤–∫–ª—é—á–∞–µ–º —Å–±–æ—Ä–∫—É Webpack Dev Server –ª–∏–±–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–±–æ—Ä–∫—É. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ *–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π* –ø—É—Ç—å –∫ —Å–±–æ—Ä–∫–µ Webpack Dev Server: `dist/js/bundle.js`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è —Å –∂–µ—Å—Ç–∫–æ–≥–æ –¥–∏—Å–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å –¥–ª—è Webpack Dev Server –ø–æ—Ä—Ç –æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≤–µ–± –ø–æ—Ä—Ç–∞.

- –ò –Ω–∞–∫–æ–Ω–µ—Ü, –≤ `src/server/index.js`, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç `console.log` —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

```js
console.log(`Server running on port ${WEB_PORT} ${isProd ? '(production)' :
  '(development).\nKeep "yarn dev:wds" running in an other terminal'}.`)
```

–≠—Ç–æ –¥–∞—Å—Ç –¥—Ä—É–≥–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –ø–æ–¥—Å–∫–∞–∑–∫—É, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å `yarn start` –±–µ–∑ Webpack Dev Server.

–•–æ—Ä–æ—à–æ, –º—ã –ø—Ä–æ–∏–∑–≤–µ–ª–∏ –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –≤—Å–µ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å:

üèÅ –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn start` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ. –û—Ç–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ –æ–∫–æ—à–∫–æ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –Ω–µ–π `yarn dev:wds`. –ö–∞–∫ —Ç–æ–ª—å–∫–æ Webpack Dev Server –∑–∞–≤–µ—Ä—à–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–±–æ—Ä–∫–∏ –∏ sourcemap –∫–∞—Ä—Ç (–≤–º–µ—Å—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~600kB —Ñ–∞–π–ª–æ–≤), –∏ –æ–±–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–≤–∏—Å–Ω—É—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –æ—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8000/` –∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å "Hello Webpack!". –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å Chrome –∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ Source –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –≤–∫–ª—é—á–µ–Ω—ã. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ `static/css/style.css` –ø–æ–¥ `localhost:8000/`, –∞ –≤—Å–µ –≤–∞—à–∏ –∏—Å—Ö–æ–¥–Ω—ã–µ ES6 —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤ `webpack://./src`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ sourcemap —Ä–∞–±–æ—Ç–∞—é—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å `Hello Webpack!` –≤ `src/client/index.js` –Ω–∞ –ª—é–±—É—é –¥—Ä—É–≥—É—é —Å—Ç—Ä–æ–∫—É —Å –ø–æ–º–æ—â—å—é —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª, –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —á—Ç–æ Webpack Dev Server —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—É—é —Å–±–æ—Ä–∫—É, –∏ –≤–∫–ª–∞–¥–∫–∞ Chrome –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å.

- –ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö —Å –ø–æ–º–æ—â—å—é Ctrl+C, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ `yarn prod:build` –∏ –∑–∞—Ç–µ–º `yarn prod:start`. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8000/`, –∏ –≤—ã –ø–æ –ø—Ä–µ–∂–Ω–µ–º—É –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å "Hello Webpack!". –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑, –≤–æ –≤–∫–ª–∞–¥–∫–µ Source –∫–æ–Ω—Å–æ–ª–∏ Chrome –ø–æ–¥ `localhost:8000/` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `static/js/bundle.js`, –Ω–æ –±–µ–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –≤ `webpack://`. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ `bundle.js` —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn prod:stop`.

–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∑–Ω–∞—é, —ç—Ç–æ –±—ã–ª–æ –¥–æ–≤–æ–ª—å–Ω–æ –ø–ª–æ—Ç–Ω–æ. –í—ã –∑–∞—Å–ª—É–∂–∏–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤! –°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –ª–µ–≥—á–µ.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –Ø –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: –æ–¥–∏–Ω –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ Express, –æ–¥–∏–Ω –¥–ª—è Webpack Dev Server –∏ –æ–¥–∏–Ω –¥–ª—è Git, —Ç–µ—Å—Ç–æ–≤ –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥, —Ç–∞–∫–∏—Ö –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `yarn`. –í –∏–¥–µ–∞–ª–µ, –Ω—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ–∫–Ω–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª–µ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∏—Ö –≤—Å–µ.

## React

> üí° **[React](https://facebook.github.io/react/)** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –æ—Ç Facebook. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å **[JSX](https://facebook.github.io/react/docs/jsx-in-depth.html)** –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Å–æ—á–µ—Ç–∞—è –µ–≥–æ —Å –º–æ—â—å—é JavaScript.

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –º—ã –±—É–¥–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Ç–µ–∫—Å—Ç —Å –ø–æ–º–æ—â—å—é React –∏ JSX.

–î–ª—è –Ω–∞—á–∞–ª–∞, –¥–∞–≤–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏–º React –∏ ReactDOM:

- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn add react react-dom`

–ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª `src/client/index.js` –≤ `src/client/index.jsx` –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –Ω–µ–º —Å–ª–µ–¥—É—é—â–∏–π React –∫–æ–¥:

```js
// @flow

import 'babel-polyfill'

import React from 'react'
import ReactDOM from 'react-dom'

import App from './app'
import { APP_CONTAINER_SELECTOR } from '../shared/config'

ReactDOM.render(<App />, document.querySelector(APP_CONTAINER_SELECTOR))
```

- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–ø–π–ª `src/client/app.jsx` —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:

```js
// @flow

import React from 'react'

const App = () => <h1>Hello React!</h1>

export default App
```

–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å JSX, –Ω–∞–º –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã Babel —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª –µ–≥–æ —Å –ø–æ–º–æ—â—å—é –ø—Ä–µ—Å–µ—Ç–∞ `babel-preset-react`. –ó–∞–æ–¥–Ω–æ, –º—ã –¥–æ–±–∞–≤–∏–º –ø–ª–∞–≥–∏–Ω –¥–ª—è Babel `flow-react-proptypes`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PropTypes –∏–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π Flow –¥–ª—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.


- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn add --dev babel-preset-react babel-plugin-flow-react-proptypes` –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.babelrc` —Ç–∞–∫:

```json
{
  "presets": [
    "env",
    "flow",
    "react"
  ],
  "plugins": [
    "flow-react-proptypes"
  ]
}
```

üèÅ –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn start` –∏ `yarn dev:wds`, –æ—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8000`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å "Hello React!".

–¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ `src/client/app.jsx` –Ω–∞ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –¥—Ä—É–≥–æ–π. Webpack Dev Server –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –∏–∑—è—â–Ω–æ, –Ω–æ –º—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å –¥–∞–∂–µ –µ—â–µ –ª—É—á—à–µ.

## Hot Module Replacement

> üí° **[Hot Module Replacement](https://webpack.js.org/concepts/hot-module-replacement/)** (*HMR*) - –º–æ—â–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å Webpack –∑–∞–º–µ–Ω—è—Ç—å –º–æ–¥—É–ª–∏ –Ω–∞ –ª–µ—Ç—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ß—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–∏—Ç—å HMR —Ä–∞–±–æ—Ç–∞—Ç—å —Å React, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å.

- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `yarn add react-hot-loader@next`

- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `webpack.config.babel.js` —Ç–∞–∫:

```js
import webpack from 'webpack'
// [...]
entry: [
  'react-hot-loader/patch',
  './src/client',
],
// [...]
devServer: {
  port: WDS_PORT,
  hot: true,
},
plugins: [
  new webpack.optimize.OccurrenceOrderPlugin(),
  new webpack.HotModuleReplacementPlugin(),
  new webpack.NamedModulesPlugin(),
  new webpack.NoEmitOnErrorsPlugin(),
],
```

- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `src/client/index.jsx`:

```js
// @flow

import 'babel-polyfill'

import React from 'react'
import ReactDOM from 'react-dom'
import { AppContainer } from 'react-hot-loader'

import App from './app'
import { APP_CONTAINER_SELECTOR } from '../shared/config'

const rootEl = document.querySelector(APP_CONTAINER_SELECTOR)

const wrapApp = AppComponent =>
  <AppContainer>
    <AppComponent />
  </AppContainer>

ReactDOM.render(wrapApp(App), rootEl)

if (module.hot) {
  // flow-disable-next-line
  module.hot.accept('./app', () => {
    // eslint-disable-next-line global-require
    const NextApp = require('./app').default
    ReactDOM.render(wrapApp(NextApp), rootEl)
  })
}
```

–ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã `App` –±—ã–ª –¥–æ—á–µ—Ä–Ω–∏–º –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ `AppContainer` –∏–∑ `react-hot-loader`, –∏ —Ç–∞–∫–∂–µ –Ω–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å `require` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏ `App` –ø—Ä–∏ hot-reloading (–≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ). –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å —è—Å–Ω—ã–º –∏ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—É DRY, –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–µ–±–æ–ª—å—à—É—é —Ñ—É–Ω–∫–∏—é `wrapApp`, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `App`. –í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ `eslint-disable global-require` –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –±–æ–ª–µ–µ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º.

üèÅ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å `yarn dev:wds`, –µ—Å–ª–∏ –æ–Ω–∏–≤—Å–µ –µ—â–µ –∑–∞–ø—É—â–µ–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ `localhost:8000`. –í –∫–æ–Ω—Å–æ–ª–∏, –≤—ã –¥–æ–ª–∂—ã —É–≤–∏–¥–µ—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≥–∏ –æ–± HMR. –í–æ–∑—å–º–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –≤ `src/client/app.jsx`, –∏ –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç—Ä–∞–∂–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª: [05 - Redux, Immutable, Fetch](05-redux-immutable-fetch.md#readme)

–ù–∞–∑–∞–¥ –≤ [–ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–∑–¥–µ–ª](03-express-nodemon-pm2_ru.md#readme) –∏–ª–∏ [—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](https://github.com/verekia/js-stack-from-scratch#table-of-contents).